<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link href="__PUBLIC__/admin/assets/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="__PUBLIC__/admin/css/style.css"/>
    <link href="__PUBLIC__/admin/assets/css/codemirror.css" rel="stylesheet">
    <link rel="stylesheet" href="__PUBLIC__/admin/assets/css/ace.min.css" />
    <link rel="stylesheet" href="__PUBLIC__/admin/assets/css/font-awesome.min.css" />
    <!--[if IE 7]>
    <link rel="stylesheet" href="__PUBLIC__/admin/assets/css/font-awesome-ie7.min.css" />
    <![endif]-->
    <!--[if lte IE 8]>
    <link rel="stylesheet" href="__PUBLIC__/admin/assets/css/ace-ie.min.css" />
    <![endif]-->
    <script src="__PUBLIC__/admin/assets/js/jquery.min.js"></script>
    <!-- <![endif]-->

    <!--[if IE]>
    <script src="http://ajax.useso.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <![endif]-->

    <!--[if !IE]> -->
    <script type="text/javascript">
        window.jQuery || document.write("<script src='__PUBLIC__/admin/assets/js/jquery-2.0.3.min.js'>"+"<"+"/script>");
    </script>

    <!-- <![endif]-->

    <!--[if IE]>
    <script type="text/javascript">
        window.jQuery || document.write("<script src='__PUBLIC__/admin/assets/js/jquery-1.10.2.min.js'>"+"<"+"/script>");
    </script>
    <![endif]-->

    <script type="text/javascript">
        if("ontouchend" in document) document.write("<script src='__PUBLIC__/admin/assets/js/jquery.mobile.custom.min.js'>"+"<"+"/script>");
    </script>
    <script src="__PUBLIC__/admin/assets/js/bootstrap.min.js"></script>
    <script src="__PUBLIC__/admin/assets/js/typeahead-bs2.min.js"></script>
    <!-- page specific plugin scripts
    <script src="__PUBLIC__/admin/assets/js/jquery.dataTables.min.js"></script>
    <script src="__PUBLIC__/admin/assets/js/jquery.dataTables.bootstrap.js"></script>
    -->
    <script src="__PUBLIC__/admin/assets/layer/layer.js" type="text/javascript"></script>
    <script src="__PUBLIC__/admin/assets/laydate/laydate.js" type="text/javascript"></script>

    <link rel="stylesheet" href="__PUBLIC__/admin/editor/themes/default/default.css" />
    <link rel="stylesheet" href="__PUBLIC__/admin/editor/plugins/code/prettify.css" />
    <script charset="utf-8" src="__PUBLIC__/admin/editor/kindeditor.js"></script>
    <script charset="utf-8" src="__PUBLIC__/admin/editor/lang/zh_CN.js"></script>
    <script charset="utf-8" src="__PUBLIC__/admin/editor/plugins/code/prettify.js"></script>

    <title>活动盛事</title>

    <script>
        KindEditor.ready(function(K)
        {
            var editor = K.create('textarea[name="content"]', {
                cssPath : '__PUBLIC__/admin/editor/plugins/code/prettify.css',
                uploadJson : '__PUBLIC__/admin/editor/php/upload_json.php',
                fileManagerJson : '__PUBLIC__/admin/editor/php/file_manager_json.php',
                allowFileManager : true,
                afterBlur: function(){this.sync();}
            });
            prettyPrint();

            var editor = K.editor({
                allowFileManager : true,
                allowImageRemote : false
            });

            K('#image_cover').click(function() {
                editor.loadPlugin('image', function() {
                    editor.plugin.imageDialog({
                        imageUrl : K('#cover').val(),
                        clickFn : function(url, title, width, height, border, align) {
                            K('#cover').val(url);
                            $('#coverimg').attr('src','https://first.xcxweshine.com/'+url);
                            editor.hideDialog();
                        }
                    });
                });
            });
            K('#audio_cover').click(function() {
                editor.loadPlugin('insertfile', function() {
                    editor.plugin.fileDialog({
                        fileUrl : K('#audio').val(),
                        clickFn : function(url, title) {
                            K('#audio').val(url);
                            editor.hideDialog();
                        }
                    });
                });
            });
            K('#video_cover').click(function() {
                editor.loadPlugin('insertfile', function() {
                    editor.plugin.fileDialog({
                        fileUrl : K('#video').val(),
                        clickFn : function(url, title) {
                            K('#video').val(url);
                            editor.hideDialog();
                        }
                    });
                });
            });

        });
    </script>
    <style></style>
</head>
<body>
<div class="clearfix" id="add_picture">
    <div class="page_right_style" style="left:0px;width: 100%;">
        <div class="type_title">编辑文章</div>
        <input type="hidden" id="id" name="id" value="{$data.id}" />
        <!--<input type="hidden" id="audioid" name="audioid" value="{$audio.id}" />-->

        <div class="form form-horizontal" id="form-article-add">
            <div class="clearfix cl">
                <label class="col-lg-2 col-md-2 col-sm-12 control-label"><span class="c-red" style="color:red;">*&nbsp;&nbsp;</span>标题：</label>
                <div class="col-lg-8 col-md-8" >
                    <div id="f_title"><input type="text" class="input-text" value="{$data.name}" placeholder="" name="name" id="name"></div>
                </div>
            </div>
            <div class="clearfix cl">
                <label class="col-lg-2 col-md-2 col-sm-12 control-label"><span class="c-red" style="color:red;">*&nbsp;&nbsp;</span>分类：</label>
                <div class="col-lg-8 col-md-8" >
                    <select id="catid" name='catid' >
                        <volist name="cate" id="vo" empty="$empty">
                            <if condition="$vo['id'] eq $data['catid']">
                                <option value="{$vo.id}" selected="selected">{$vo.name}</option>
                                <else />
                                <option value="{$vo.id}">{$vo.name}</option>
                            </if>
                        </volist>
                    </select>
                </div>
            </div>
            <!--<div class="clearfix cl">-->
            <!--<label class="col-lg-2 col-md-2 col-sm-12 control-label"><span class="c-red" style="color:red;">*&nbsp;&nbsp;</span>介绍：</label>-->
            <!--<div class="col-lg-8 col-md-8" >-->
            <!--<textarea name="introduction" id="introduction" style="width:100% " rows="5">{$data.introduction}</textarea>-->
            <!--</div>-->
            <!--</div>-->


            <div class="clearfix cl">
                <label class="col-lg-2 col-md-2 col-sm-12 control-label">封面：</label>
                <div class="col-lg-6 col-md-6" id="f_banner">
                    <input type="text" class="form-control" name="cover" id="cover" value="{$data.cover}" style="margin-bottom:10px;">
                    <span style="color:red">注 : 建议尺寸375*200</span>
                </div>
                <div class="col-lg-1 col-md-1">
                    <input type="button" id="image_cover" value="选择图片" class="form-control btn btn-success" style="color:#fff;"/>
                </div>
            </div>
            <div class="clearfix cl">
                <label class="col-lg-2 col-md-2 col-sm-12 control-label">封面：</label>
                <div class="col-lg-6 col-md-6" id="">
                    <img src="https://first.xcxweshine.com/{$data.cover}" id="coverimg" width="375px" height="200" style="border:1px solid lightgrey" alt="">
                </div>
            </div>

            <!--
                <div class="clearfix cl">
                    <label class="col-lg-2 col-md-2 col-sm-12 control-label">关键词：</label>
                    <div class="col-lg-8 col-md-8">
                        <input type="text" class="input-text" value="{$list[0].keysword}" placeholder="" id="keysword" name="keysword">
                    </div>
                </div>

                <div class="clearfix cl">
                    <label class="col-lg-2 col-md-2 col-sm-12 control-label">内容摘要：</label>
                    <div class="col-lg-8 col-md-8">
                        <textarea name="description" id="description" style="width:100%;height:80px;" placeholder="说点什么...最少输入10个字符" datatype="*10-100" dragonfly="true" nullmsg="备注不能为空！" onKeyUp="textarealength(this,200)">{$list[0].description}</textarea>
                    </div>
                </div>-->
            <!--<div class="clearfix cl">
                <div>
                    <label class="col-lg-2 col-md-2 col-sm-12 control-label"><span class="c-red" style="color:red;">*&nbsp;&nbsp;</span>收费方式：</label>
                    <div class="col-lg-8 col-md-8" style="padding-top: 8px;">
                        <label for="validityall">
                            <input type="radio" value="0" name="validitytype" checked="checked"  id="validityall">免费
                        </label>
                    </div>
                </div>
            </div>-->
            <!--<div class="clearfix cl">-->
            <!--<label class="col-lg-2 col-md-2 col-sm-12 control-label"><span class="c-red" style="color:red;">*&nbsp;&nbsp;</span>价格</label>-->
            <!--<div class="col-lg-8 col-md-8">-->
            <!--<label for="validitydate">
                <input type="radio" value="1" placeholder="" name="validitytype" id="validitydate">收费
            </label>
            &nbsp;&nbsp;&nbsp;&nbsp;-->
            <!--<input type="text" id="price" name="price" value="{$data.price}"  class="text_time"/> 元 <span style="color:red">注 : (填写0为免费)</span>-->

            <!--</div>-->
            <!--</div>-->
            <!--
                        <div class="clearfix cl">
                            <label class="col-lg-2 col-md-2 col-sm-12 control-label">缩略图：</label>
                            <div class="col-lg-6 col-md-6">
                                <input type="text" class="form-control" name="pic" id="pic" value="{$list[0].pic}" style="margin-bottom:10px;">
                            </div>
                            <div class="col-lg-1 col-md-1">
                                <input type="button" id="image_pic" value="选择图片" class="form-control btn btn-success" style="color:#fff;"/>
                            </div>
                        </div>-->

            <div class="clearfix cl">
                <label class="col-lg-2 col-md-2 col-sm-12 control-label"><span class="c-red" style="color:red;">*&nbsp;&nbsp;</span>详细内容：</label>
                <div class="col-lg-8 col-md-8 ">
                    <div id="f_content"><textarea id="content" name="content" style="height:400px;width:100%;">{$data.content}</textarea></div>
                </div>
            </div>

            <!--<div class="clearfix cl">-->
            <!--<label class="col-lg-2 col-md-2 col-sm-12 control-label">上传音频：</label>-->
            <!--<div class="col-lg-6 col-md-6" id="audio'">-->
            <!--<input type="text" class="form-control" name="audio" id="audio" value="{$audio.filepath}" style="margin-bottom:10px;">-->
            <!--<span style="color:red">注 : 此处音频将会计入播放统计</span>-->
            <!--</div>-->
            <!--<div class="col-lg-1 col-md-1">-->
            <!--<input type="button" id="audio_cover" value="选择音频" class="form-control btn btn-success" style="color:#fff;"/>-->

            <!--</div>-->

            <!--</div>-->
            <!--<div class="clearfix cl">-->
            <!--<label class="col-lg-2 col-md-2 col-sm-12 control-label">上传视频：</label>-->
            <!--<div class="col-lg-6 col-md-6" id="video'">-->
            <!--<input type="text" class="form-control" name="video" id="video" value="{$data.videopath}" style="margin-bottom:10px;">-->
            <!--</div>-->
            <!--<div class="col-lg-1 col-md-1">-->
            <!--<input type="button" id="video_cover" value="选择视频" class="form-control btn btn-success" style="color:#fff;"/>-->
            <!--</div>-->
            <!--</div>-->
            <div class="clearfix cl">
                <div class="Button_operation">
                    <button class="btn btn-primary radius" type="button" id="f_submit"><i class="icon-save "></i>保存</button>
                    <button class="btn btn-default radius" type="reset" onclick="history.back()">&nbsp;&nbsp;取消&nbsp;&nbsp;</button>

                </div>
            </div>
        </div>
    </div>
</div>
</div>
<script>
    var checkResult = {};
    var Check = {



        checkContent : function() {
            var contentEl = $("#content"),
                content = $.trim(contentEl.val());

            contentEl.val(content);

            if(content == ""){
                $("#f_content").removeClass().addClass("has-error");
                layer.msg("详细内容不能为空！",{icon:2,time:1000},function(){});
                return false;
            }
            else {
                $("#f_content").removeClass().addClass("has-success");
                return true;
            }
        },

        checkSubmit : function() {

            $("#content") && Check.checkContent();
            var name=$('#name').val()
            var catid=$('#catid').val();
            var content=$("#content").val()
            var cover = $("#cover").val();
            // var price = $("#price").val();
            // var audio = $("#audio").val();
            // var video = $("#video").val();

            var id=$('#id').val()
            // var audioid=$('#audioid').val()

            if(name==''){
                layer.msg("请输入标题！",{icon:2,time:1000},function(){});
                return false;
            }
            if (catid==''){
                layer.msg("请填写分类！",{icon:2,time:1000},function(){});
                return false;
            }
            if(cover==''){
                layer.msg("请上传封面图片!",{icon:2,time:1000},function () {

                });
                return false;
            }
            if (content==''){
                layer.msg("请填写详细内容！",{icon:2,time:1000},function(){});
                return false;
            }
            // if (audio==''){
            //     layer.msg("请上传音频！",{icon:2,time:1000},function(){});
            //     return false;
            // }
            var data = {
                id:id,
                // audioid:audioid,
                name:name,
                // introduction:introduction,
                catid:catid,
                content:content,
                cover:cover,
                // price:price,
                // audio:audio,
                // video:video
            };
            $.ajax(
                {
                    url:'__URL__/savestrategy',
                    data:data,
                    type:'POST',
                    dataType:'json',
                    success:function(json){

                        if(json.flag==1){
                            layer.msg('成功!',{icon:1,time:2000},function(){
                                window.location.href="__URL__";
                                //parent.location.reload(); // 父页面刷新
                                var index = parent.layer.getFrameIndex(window.name); //获取窗口索引
                                parent.layer.close(index);
                            });
                        }else{
                            layer.msg('失败!',{icon:2,time:1000},function(){return false;});
                        }
                    }
                }
            )

        },

    };


    $(document).ready(function(){

        $("#title").blur(Check.checkTitle);
        $("#content").blur(Check.checkContent);
        $("#f_submit").click(Check.checkSubmit);


    });
</script>
</body>
</html>